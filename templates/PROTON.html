<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROTON - System Workflows</title>
    <link rel="icon" href="{{ favicon_url }}">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'loose' });
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .card { background: #ffffff; border: 1px solid rgba(0,0,0,0.06); border-radius: 16px; box-shadow: 0 10px 24px rgba(2, 6, 23, 0.08); }
        .diagram { overflow: auto; }
        .mm-title { font-weight: 700; color: #0f172a; }
        .sub { color: #475569; }
        .section-title { font-size: 20px; font-weight: 700; color: #0f172a; }
        .muted { color: #64748b; }
        .grid-auto { display: grid; grid-template-columns: 1fr; gap: 24px; }
        @media (min-width: 1024px) { .grid-auto { grid-template-columns: 1fr 1fr; } }
        .mermaid { background: #f8fafc; border-radius: 12px; padding: 12px; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">
    <header class="bg-white border-b border-slate-200/60 sticky top-0 z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <img src="{{ logo_url }}" alt="Logo" style="height: 36px;">
                <strong class="text-slate-900">Workflows</strong>
            </div>
            <a href="{{ url_for('employee_corner') }}" class="text-sm font-semibold text-slate-600 hover:text-slate-900">← Back to Employee Corner</a>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">
        <div class="card p-6">
            <h1 class="text-2xl sm:text-3xl mm-title mb-2">End-to-End User Flow</h1>
            <p class="sub mb-4">Simple journey from the public website to everyday work areas.</p>
            <div class="diagram">
                <div class="mermaid">
flowchart LR
    Start[Public website] --> Choice{Who is signing in?}
    Choice -->|Admin| AdminLogin[Sign in as admin]
    Choice -->|Client| ClientLogin[Enter client code]
    AdminLogin -->|Approved| Home[Home page]
    AdminLogin -->|Needs approval| Pending[Waiting for approval]
    ClientLogin --> Home
    Home --> Dashboard[Work area]
    Home --> Insights[Reports and charts]
    Dashboard --> Projects[List of projects]
    Dashboard --> Tasks[Load tasks]
    Dashboard --> Import[Import from Excel or CSV]
    Dashboard --> Edit[Add, edit, delete tasks]
    Dashboard --> Files[Upload or download files]
    Dashboard --> Share[Show or hide items for client]
    Dashboard --> History[Recent activity]
    Insights --> Data[Load data for charts]
                </div>
            </div>
        </div>

        <div class="grid-auto">
            <div class="card p-6">
                <div class="section-title mb-2">Admin Journey</div>
                <p class="muted mb-4">How a new team member signs up, gets approved, and signs in.</p>
                <div class="diagram">
                    <div class="mermaid">
sequenceDiagram
    participant L as Website
    participant S as Sign up
    participant SA as Approver
    participant A as Approve
    participant LG as Sign in
    participant H as Home

    L->>S: Enter email and password
    S-->>L: Account waiting for approval
    SA->>A: Approve the person
    A-->>SA: Person approved
    L->>LG: Sign in as admin
    LG-->>H: Go to Home
                    </div>
                </div>
            </div>

            <div class="card p-6">
                <div class="section-title mb-2">Client Access</div>
                <p class="muted mb-4">How a client gets in using a code.</p>
                <div class="diagram">
                    <div class="mermaid">
sequenceDiagram
    participant L as Website
    participant LG as Sign in
    participant H as Home
    participant P as Projects

    L->>LG: Enter client code
    LG-->>H: Open Home for that project
    H->>P: See list of projects (admins only)
                    </div>
                </div>
            </div>

            <div class="card p-6">
                <div class="section-title mb-2">Project & Task Data Flow</div>
                <p class="muted mb-4">Where information is kept and how it is saved safely.</p>
                <div class="diagram">
                    <div class="mermaid">
flowchart TB
    subgraph Files
        PROFILES[User and project list file]
        LOGS[Activity log file]
        DATA[Project tasks file]
    end
    App[Web pages] --> Server[App server]
    Server --> Cache[Smart file cache]
    Cache --> PROFILES
    Cache --> LOGS
    Cache --> DATA
    Server --> Lock[Lock file while saving]
    Lock --> DATA
    Server --> Save[Save to file]
    Save --> DATA
    Server --> Record[Write to log]
    Record --> LOGS
                    </div>
                </div>
            </div>

            <div class="card p-6">
                <div class="section-title mb-2">CSV Import to Hierarchy</div>
                <p class="muted mb-4">How an Excel or CSV file becomes a clean task list.</p>
                <div class="diagram">
                    <div class="mermaid">
flowchart TB
    Upload[Upload CSV file] --> Clean[Clean and match column names]
    Clean --> Dates[Convert dates and numbers]
    Dates --> Map[Match items using WBS code]
    Map --> Tree[Build task tree]
    Tree --> Progress[Recalculate progress]
    Progress --> SaveCSV[Save to project file]
                    </div>
                </div>
            </div>
        </div>

        <div class="card p-6">
                <div class="section-title mb-2">Working With Tasks</div>
                <p class="muted mb-4">Adding, editing, and deleting tasks and keeping totals up to date.</p>
            <div class="diagram">
                <div class="mermaid">
stateDiagram-v2
    [*] --> Looking
    Looking --> Adding: Add a task
    Adding --> Renumber: Keep task numbers tidy
    Renumber --> Recount: Refresh progress totals
    Recount --> Saved: Save changes
    Looking --> Editing: Change a task
    Editing --> Recount
    Looking --> Deleting: Remove a task
    Deleting --> Renumber
                </div>
            </div>
        </div>

        <div class="grid-auto">
            <div class="card p-6">
                <div class="section-title mb-2">Files and Attachments</div>
                <p class="muted mb-4">Add files to a task and download them later.</p>
                <div class="diagram">
                    <div class="mermaid">
flowchart LR
    U[Click upload] --> UD[Send file]
    UD --> FS[(Folder for the project and task)]
    D[Click download] --> DD[Get file]
    Z[Download many at once] --> ZA[Create a zip]
    ZA --> ZIP[(One zip file returned)]
                    </div>
                </div>
            </div>

            <div class="card p-6">
                <div class="section-title mb-2">Show to Client</div>
                <p class="muted mb-4">Turn on or off what the client can see for the whole list.</p>
                <div class="diagram">
                    <div class="mermaid">
flowchart TB
    UI[Select show everything to client] --> Step1[Lock the file briefly]
    Step1 --> Step2[Turn on the switch on all tasks]
    Step2 --> Step3[Save the file]
    Step3 --> Step4[Unlock the file]
                    </div>
                </div>
            </div>
        </div>

        <div class="grid-auto">
            <div class="card p-6">
                <div class="section-title mb-2">Charts and Reports</div>
                <p class="muted mb-4">Where the numbers for the charts come from.</p>
                <div class="diagram">
                    <div class="mermaid">
flowchart LR
    CH[Charts page] --> CD[Ask server for chart data]
    CD --> EPC[Progress by Engineering, Procurement, Construction]
    CD --> DEL[Total delay days]
    CD --> SC[Planned vs actual progress over time]
    CD --> NEXT[Next important task]
    EPC --> UIE[Shown as donut or bars]
    DEL --> UID[Shown as bars]
    SC --> UIL[Shown as a line]
    NEXT --> UIN[Shown in a small card]
                    </div>
                </div>
            </div>

            <div class="card p-6">
                <div class="section-title mb-2">Activity History</div>
                <p class="muted mb-4">We keep a simple list of what happened and when.</p>
                <div class="diagram">
                    <div class="mermaid">
flowchart TB
    Actions[Add, edit, delete tasks, upload files, sign in] --> LOG[Write a short note]
    LOG --> APPEND[Add it to the top of the list]
    APPEND --> AL[(Activity log file)]
    View[See recent activity] --> AL
    Download[Download as spreadsheet] --> AL
                    </div>
                </div>
            </div>
        </div>

        <div class="card p-6">
            <div class="section-title mb-2">Security & Concurrency Notes</div>
            <ul class="list-disc pl-6 text-slate-600 space-y-2">
                <li>Password hashing: SHA-256 for admin credentials.</li>
                <li>Role separation: admin vs client; client scoped to project via access code.</li>
                <li>File caching with mtime validation; JSON writes invalidate cache.</li>
                <li>File locks per project data during writes to avoid corruption.</li>
                <li>CORS: wildcard enabled at response level.</li>
            </ul>
        </div>

        <div class="text-center text-sm text-slate-500 pb-8">
            <span>PROTON Workflows • Standalone architecture overview</span>
        </div>

    </main>
    <footer class="py-4 border-t border-slate-200 bg-white">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<p class="text-center text-sm text-slate-500">© Simon India Limited. All Rights Reserved.</p>
		</div>
	</footer>
</body>
</html>


